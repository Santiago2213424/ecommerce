<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Mi carrito | Smart Store</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet"
		  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        body {
            background:#f4f6f9;
            font-family: 'Poppins', system-ui;
        }

        /* NAVBAR */
		.navbar {
		    background: #0A3D62;
		    padding: 14px 30px !important;
		}

		.navbar a {
		    color: white !important;
		    font-weight: 600;
		    font-size: 20px !important;  
		    text-decoration: none !important;
		}


        /* TARJETA DE PRODUCTO */
        .product-card {
            background:white;
            border-radius:14px;
            padding:18px;
            box-shadow:0 3px 10px rgba(0,0,0,0.08);
            border:1px solid #e5e5e5;
            transition:0.2s;
        }
        .product-card:hover {
            transform:scale(1.01);
        }

        .product-img {
            height:180px;
            width:100%;
            object-fit:cover;
            border-radius:10px;
        }

        .line {
            display:flex;
            justify-content:space-between;
            font-size:14px;
            padding:4px 0;
        }

        /* TOTAL */
        .total-box {
            background:white;
            border-radius:12px;
            padding:20px;
            box-shadow:0 3px 10px rgba(0,0,0,0.07);
            border:1px solid #e5e5e5;
        }

        /* BOTONES */
        .btn-principal {
            background:#0A3D62;
            color:white;
            font-weight:600;
            border-radius:999px;
            padding:10px 18px;
        }
        .btn-principal:hover {
            background:#062742;
            color:white;
        }
		
		.nav-icon-link {
		    font-size:25px;
		    color:white !important;
		    display:inline-flex;
		    align-items:center;
		    justify-content:center;
		    cursor:pointer;
		}

    </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">

		<a class="navbar-brand ms-3" href="/" 
		   style="font-size:20px; font-weight:600; text-decoration:none !important;">
		    Smart Store
		</a>


		<div class="ms-auto d-flex align-items-center gap-4">
		    <span id="userIcon" class="nav-icon-link d-flex align-items-center" style="font-size:20px; cursor:pointer;">
		        <i class="bi bi-person-circle"></i>

		        <!-- SEPARACIÓN DEL TEXTO -->
		        <span style="margin-left:8px;">
		            <span sec:authentication="principal.nombre"></span>
		            <span sec:authentication="principal.apellido"></span>
		        </span>
		    </span>
		</div>

		


            <!-- LOGIN -->
            <a th:href="@{/login}" class="btn btn-outline-light btn-sm"
               sec:authorize="!isAuthenticated()">
                Iniciar sesión
            </a>

        </div>
    </div>
</nav>

<!-- CONTENIDO -->
<div class="container py-5">

	<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
	    <h2 class="fw-bold">Mi Carrito</h2>

	    <a href="/compras" class="btn-principal" 
	       style="text-decoration:none !important;">
	        ← Seguir comprando
	    </a>
	</div>

    <!-- Carrito vacío -->
    <div th:if="${#lists.isEmpty(carrito)}" class="text-center py-5 text-muted">
        <h4 class="fw-bold">Tu carrito está vacío</h4>
        <p>Agrega productos para verlos aquí.</p>
        <a href="/compras" class="btn-principal mt-3">Explorar productos</a>
    </div>

    <!-- PRODUCTOS -->
    <div class="row g-4" th:if="${!#lists.isEmpty(carrito)}">

        <div class="col-md-4" th:each="item : ${carrito}">
            <div class="product-card">

                <img th:src="@{'/uploads/' + ${item.producto.imagen}}" class="product-img">

                <h5 class="mt-2" th:text="${item.producto.nombre}"></h5>

                <div class="line text-muted">
                    <span>Precio</span>
                    <span th:text="'S/ ' + ${item.producto.precio}"></span>
                </div>

                <div class="line text-muted">
                    <span>Cantidad</span>
                    <span th:text="${item.cantidad}"></span>
                </div>

                <div class="line fw-bold">
                    <span>Subtotal</span>
                    <span th:text="'S/ ' + ${item.subtotal}"></span>
                </div>

                <a th:href="@{'/carrito-usuario/eliminar/' + ${item.producto.id}}"
                   class="btn btn-danger w-100 mt-3">
                    Eliminar
                </a>

            </div>
        </div>

    </div>

    <!-- TOTAL -->
    <div class="mt-4 total-box" th:if="${!#lists.isEmpty(carrito)}">
        <div class="d-flex justify-content-between">
            <h4>Total a pagar:</h4>
            <h4 th:text="'S/ ' + ${total}"></h4>
        </div>

        <a href="/carrito-usuario/pago" class="btn btn-success w-100 mt-3 py-2 fw-bold">
            Ir a pagar ✔
        </a>
    </div>

</div>

</body>
</html>
