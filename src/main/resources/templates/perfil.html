<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Mi Perfil | Smart Store</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet"
		  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	  

    <style>
        body {
            background:#f4f6f9;
            font-family:'Poppins', sans-serif;
        }

        /* NAVBAR (MISMO ESTILO QUE CARRITO) */
        .navbar {
            background:#0A3D62;
            padding:14px 30px !important;
        }
        .navbar a {
            color:white !important;
            font-weight:600;
            text-decoration:none !important;
            font-size:18px;
        }

        /* POPUP USUARIO (IGUAL AL CARRITO ADMIN) */
        #userPopup {
            position:absolute;
            right:0;
            top:35px;
            width:230px;
            padding:18px 20px;
            background:white;
            color:black;
            border-radius:12px;
            border:1px solid #dcdcdc;
            box-shadow:0 4px 15px rgba(0,0,0,0.25);
            display:none;
            opacity:0;
            transform:translateY(-10px);
            transition:.25s;
            z-index:5000;
            text-align:center;
        }
        #userPopup a {
            display:block;
            font-weight:600;
            margin-top:10px;
            color:rgb(0,0,160) !important;
        }
        #userPopup .logout-btn {
            margin-top:12px;
            background:#ff4d4d;
            color:white !important;
            padding:10px 0;
            border-radius:8px;
        }
		
		#userPopup p {
		    margin: 0 !important;
		    line-height: 1.1;  /* opcional, m√°s compacto todav√≠a */
		}
		
		#userPopup hr {
			margin: 6px 0;     
		}

		#userPopup .logout-btn {
			margin-top: 10px;   
			display: block;
			width: 100%;      
		}

        .fade-in { opacity:1 !important; transform:translateY(0) !important; }
        .fade-out { opacity:0 !important; transform:translateY(-10px) !important; }

        /* SIDEBAR (SOLO ADMIN ‚Äì MISMO QUE CARRITO ADMIN) */
        #sideMenu {
            position:fixed;
            top:0; left:-260px;
            width:260px;
            height:100vh;
            background:#0A3D62;
            color:white;
            padding:20px;
            transition:left .3s ease-in-out;
            z-index:3000;
        }
        #sideMenu a {
            display:block;
            padding:10px;
            border-radius:6px;
            margin-bottom:6px;
            text-decoration:none;
            color:white !important;
        }
        #sideMenu a:hover { background:#07456F; }
        #closeMenu {
            font-size:26px;
            cursor:pointer;
            margin-bottom:15px;
        }

        /* CARD PERFIL */
        .perfil-card {
            background:white;
            border-radius:14px;
            padding:25px;
            max-width: 500px;
            margin:auto;
            box-shadow:0 4px 12px rgba(0,0,0,0.10);
            border:1px solid #e5e5e5;
        }

        .perfil-linea {
            display:flex;
            justify-content:space-between;
            font-size:16px;
            padding:8px 0;
        }

        .btn-principal {
            background:#0A3D62;
            color:white;
            font-weight:600;
            border-radius:999px;
            padding:10px 18px;
            text-decoration:none !important;
        }
        .btn-principal:hover { background:#062742; }

		.nav-icon-link {
		    font-size:25px;
		    color:white !important;
		    display:inline-flex;
		    align-items:center;
		    justify-content:center;
		    cursor:pointer;
		}

    </style>

</head>

<body>

<!-- üîµ NAVBAR ADMIN (IGUAL AL DEL CARRITO ADMIN) -->
<nav class="navbar navbar-expand-lg navbar-dark"
     sec:authorize="hasRole('ADMIN')">

    <span style="font-size:26px; cursor:pointer; color:white;"
          onclick="openMenu()">&#9776;</span>

    <a class="navbar-brand ms-3" href="/dashboard">
        Smart Store Admin
    </a>

    <div class="ms-auto d-flex align-items-center gap-4">

		<!-- üõí CARRITO -->
		<a th:href="@{/carrito}" class="nav-icon-link">
		    <i class="bi bi-cart3"></i>
		</a>

		<!-- üë§ USUARIO -->
		<div sec:authorize="isAuthenticated()" class="position-relative">
		    <span id="userIcon" class="nav-icon-link" style="font-size:27px;">
		        <i class="bi bi-person-circle"></i>
		    </span>

		    <div id="userPopup">
		        <p style="margin:0; font-size:18px; font-weight:700;">
		            Hola <span sec:authentication="principal.nombre"></span>!
		        </p>

		        <a th:href="@{/perfil}">Ver perfil</a>
		        <a th:href="@{/mis-pedidos}">Mis compras</a>
		        <hr>
		        <a th:href="@{/logout}" class="logout-btn">Cerrar sesi√≥n</a>
		    </div>
		</div>

		
    </div>
</nav>

<!-- üîµ NAVBAR USER (MISMOS COLORES QUE CARRITO USUARIO + CARRITO + üë§ + POPUP) -->
<nav class="navbar navbar-expand-lg navbar-dark"
     sec:authorize="hasRole('USER')">
    <div class="container-fluid">

        <a class="navbar-brand ms-3" href="/" 
           style="font-size:20px; font-weight:600; text-decoration:none !important;">
            Smart Store
        </a>

        <div class="ms-auto d-flex align-items-center gap-4">

            <!-- CARRITO USUARIO -->
			<!-- üõí CARRITO -->
			<a th:href="@{/carrito}" class="nav-icon-link">
			    <i class="bi bi-cart3"></i>
			</a>

			<!-- üë§ USUARIO -->
			<div sec:authorize="isAuthenticated()" class="position-relative">
			    <span id="userIcon" class="nav-icon-link" style="font-size:27px;">
			        <i class="bi bi-person-circle"></i>
			    </span>

			    <div id="userPopup">
			        <p style="margin:0; font-size:18px; font-weight:700;">
			            Hola <span sec:authentication="principal.nombre"></span>!
			        </p>

			        <a th:href="@{/perfil}">Ver perfil</a>
			        <a th:href="@{/mis-pedidos}">Mis compras</a>
			        <hr>
			        <a th:href="@{/logout}" class="logout-btn">Cerrar sesi√≥n</a>
			    </div>
			</div>

			

        </div>
    </div>
</nav>

<!-- SIDEBAR SOLO ADMIN -->
<div id="sideMenu" sec:authorize="hasRole('ADMIN')">
    <div id="closeMenu" onclick="closeMenu()">‚úñ</div>

    <a href="/dashboard">Dashboard</a>
    <a href="/products">Productos</a>
    <a href="/categorias">Categor√≠as</a>
    <a href="/ventas">Reporte de Ventas</a>
	<a href="/usuarios">Usuarios</a> 
	<a href="/estadisticas">Estadisticas</a>
</div>

<!-- CONTENIDO PERFIL -->
<div class="container py-5">

    <div class="mb-3">
        <!-- Atr√°s seg√∫n rol -->
        <a th:href="@{/dashboard}" class="btn-principal" style="font-size:15px; margin-top:50px;"
           sec:authorize="hasRole('ADMIN')">‚Üê Atr√°s</a>

        <a th:href="@{/compras}" class="btn-principal" style="font-size:15px; margin-top:50px;"
           sec:authorize="hasRole('USER')">‚Üê Atr√°s</a>
    </div>

    <h2 class="fw-bold text-center mb-4">Mi Perfil</h2>

    <div class="perfil-card">

        <div class="perfil-linea">
            <strong>Nombre:</strong>
            <span th:text="${usuario.nombre}"></span>
        </div>

        <div class="perfil-linea">
            <strong>Apellido:</strong>
            <span th:text="${usuario.apellido}"></span>
        </div>

        <div class="perfil-linea">
            <strong>Correo:</strong>
            <span th:text="${usuario.correo}"></span>
        </div>

        <div class="perfil-linea">
            <strong>Rol:</strong>
            <span th:text="${usuario.rol}"></span>
        </div>

        <hr class="my-4">

        <div class="text-center">
            <a href="/perfil/cambiar-password" class="btn-principal w-100 mt-2">
                Cambiar contrase√±a üîí
            </a>
        </div>

    </div>

</div>

<!-- JS POPUP & SIDEBAR (REUTILIZADO) -->
<script>
function openMenu(){ 
    const menu = document.getElementById("sideMenu");
    if(menu) menu.style.left = "0";
}
function closeMenu(){ 
    const menu = document.getElementById("sideMenu");
    if(menu) menu.style.left = "-260px"; 
}

const userIcon = document.getElementById("userIcon");
const popup = document.getElementById("userPopup");

if(userIcon && popup){
    userIcon.addEventListener("click",(e)=>{
        e.stopPropagation();
        popup.style.display==="block" ? hidePopup() : showPopup();
    });

    function showPopup(){
        popup.style.display="block";
        requestAnimationFrame(()=>popup.classList.add("fade-in"));
    }
    function hidePopup(){
        popup.classList.remove("fade-in");
        popup.classList.add("fade-out");
        setTimeout(()=>{
            popup.style.display="none";
            popup.classList.remove("fade-out");
        },250);
    }

    document.addEventListener("click",(e)=>{
        if(!popup.contains(e.target) && e.target!==userIcon && popup.style.display==="block"){
            hidePopup();
        }
    });
}

document.addEventListener("click", (e) => {

    const menu = document.getElementById("sideMenu");
    const isMenuOpen = menu.style.left === "0px";

    if (!isMenuOpen) return;

    const clickedInsideMenu = menu.contains(e.target);
    const clickedOpenButton = e.target.getAttribute("onclick") === "openMenu()";

    if (!clickedInsideMenu && !clickedOpenButton) {
        closeMenu();
    }
});
</script>

</body>
</html>
