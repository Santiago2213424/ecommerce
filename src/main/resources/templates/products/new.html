<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Nuevo Producto | Smart Store</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
		  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	  

    <style>
        body {
            background:#f4f6f9;
            font-family:'Poppins', sans-serif;
        }

        /* NAVBAR */
        .navbar {
            background:#0A3D62;
            padding:14px 30px !important;
        }
        .navbar a {
            color:white !important;
            font-weight:600;
            font-size:18px;
            text-decoration:none !important;
        }

        /* SIDEBAR */
        #sideMenu {
            position: fixed;
            top:0;
            left:-260px;
            width:260px;
            height:100vh;
            background:#0A3D62;
            color:white;
            padding:20px;
            transition:left .3s ease-in-out;
            z-index:3000;
        }

        #sideMenu a {
            display:block;
            padding:10px;
            margin-bottom:6px;
            border-radius:6px;
            color:white !important;
            text-decoration:none;
        }

        #sideMenu a:hover {
            background:#07456F;
        }

        #closeMenu {
            font-size:26px;
            cursor:pointer;
            margin-bottom:15px;
        }

        /* POPUP USUARIO */
        #userPopup {
            display:none;
            position:absolute;
            right:0;
            top:35px;
            width:230px;
            padding:18px 20px;
            background:white;
            border-radius:12px;
            border:1px solid #dcdcdc;
            box-shadow:0 4px 15px rgba(0,0,0,0.25);
            z-index:5000;

            /* Estado inicial */
            opacity:0;
            transform:translateY(-10px);
            transition:opacity 0.25s ease, transform 0.25s ease;
            text-align:center;
        }

        .fade-in {
            opacity:1 !important;
            transform:translateY(0) !important;
        }

        .fade-out {
            opacity:0 !important;
            transform:translateY(-10px) !important;
        }

        #userPopup a {
            display:block;
            width:100%;
            margin-top:10px;
            font-weight:600;
            color:rgb(0,0,160) !important;
        }

		#userPopup hr {
		    margin: 6px 0;   
		}

		#userPopup .logout-btn {
		    margin-top: 6px; 
		    display: block;
		    width: 100%;      
		}

		
        #userPopup .logout-btn {
            width:100%;
            background:#ff4d4d;
            color:white !important;
            font-weight:bold;
            padding:10px 0;
            border-radius:8px;
            margin-top:10px;
        }

        /* FORMULARIO */
        .form-container {
            max-width:600px;
            margin:auto;
            padding:30px;
            background:white;
            border-radius:12px;
            box-shadow:0 4px 15px rgba(0,0,0,0.08);
        }

        h2 {
            font-weight:700;
            text-align:center;
            margin-bottom:20px;
        }
		
		.nav-icon-link {
		    font-size:25px;
		    color:white !important;
		    display:inline-flex;
		    align-items:center;
		    justify-content:center;
		    cursor:pointer;
		}

    </style>

</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <span style="font-size:26px; cursor:pointer; color:white;"
          onclick="openMenu()">&#9776;</span>

    <a class="navbar-brand ms-3" href="/dashboard">Smart Store Admin</a>

    <div class="ms-auto d-flex align-items-center gap-4">

        <!-- CARRITO -->
		<!-- üõí CARRITO -->
		<a th:href="@{/carrito}" class="nav-icon-link">
		    <i class="bi bi-cart3"></i>
		</a>

		<!-- üë§ USUARIO -->
		<div sec:authorize="isAuthenticated()" class="position-relative">
		    <span id="userIcon" class="nav-icon-link" style="font-size:27px;">
		        <i class="bi bi-person-circle"></i>
		    </span>

		    <div id="userPopup">
		        <p style="margin:0; font-size:18px; font-weight:700;">
		            Hola <span sec:authentication="principal.nombre"></span>!
		        </p>

		        <a th:href="@{/perfil}">Ver perfil</a>
		        <a th:href="@{/mis-pedidos}">Mis compras</a>
		        <hr>
		        <a th:href="@{/logout}" class="logout-btn">Cerrar sesi√≥n</a>
		    </div>
		</div>

    </div>
</nav>


<!-- SIDEBAR -->
<div id="sideMenu">
    <div id="closeMenu" onclick="closeMenu()">‚úñ</div>

    <a href="/dashboard">Pagina Principal</a>
    <a href="/products">Productos</a>
    <a href="/categorias">Categor√≠as</a>
    <a href="/ventas">Reporte de Ventas</a>
	<a href="/usuarios">Usuarios</a> 
	<a href="/estadisticas">Estadisticas</a>
</div>


<!-- CONTENIDO -->
<div class="container mt-4">

    <div class="form-container">
        <h2>Registrar Producto</h2>

        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>

        <form action="/products/save" method="post" enctype="multipart/form-data">

            <div class="mb-3">
                <label class="form-label">Nombre:</label>
                <input type="text" name="nombre" class="form-control" required maxlength="50">
            </div>

            <div class="mb-3">
                <label class="form-label">Descripci√≥n:</label>
                <textarea name="descripcion" class="form-control" rows="4" maxlength="500"></textarea>
            </div>

            <div class="mb-3">
                <label class="form-label">Precio:</label>
                <input type="number" name="precio" min="0.01" step="0.01"
                       class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Cantidad:</label>
                <input type="number" name="cantidad" min="1" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Categor√≠a:</label>
                <select name="categoriaId" class="form-select" required>
                    <option value="">-- Seleccione --</option>
                    <option th:each="c : ${categorias}"
                            th:value="${c.id}"
                            th:text="${c.nombre}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Imagen:</label>
                <input type="file" name="imagen" class="form-control" accept="image/*" required>
            </div>

            <div class="d-flex gap-2">
                <a href="/products" class="btn btn-secondary w-50">Cancelar</a>
                <button class="btn btn-primary w-50">Guardar</button>
            </div>

        </form>
    </div>

</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>

// ==========================
//       SIDEBAR
// ==========================

function openMenu() {
    document.getElementById("sideMenu").style.left = "0";
}

function closeMenu() {
    document.getElementById("sideMenu").style.left = "-260px";
}

document.addEventListener("click", (e) => {
    const menu = document.getElementById("sideMenu");

    if (menu.style.left !== "0px") return;

    const clickedInsideMenu = menu.contains(e.target);
    const clickedOpenButton = e.target.getAttribute("onclick") === "openMenu()";

    if (!clickedInsideMenu && !clickedOpenButton) {
        closeMenu();
    }
});


// ==========================
//       POPUP USUARIO
// ==========================

const userIcon = document.getElementById("userIcon");
const popup = document.getElementById("userPopup");

function showPopup() {
    popup.style.display = "block";
    requestAnimationFrame(() => popup.classList.add("fade-in"));
}

function hidePopup() {
    popup.classList.remove("fade-in");
    popup.classList.add("fade-out");
    setTimeout(() => popup.style.display = "none", 250);
}

userIcon.addEventListener("click", (e) => {
    e.stopPropagation();

    if (popup.style.display === "block") hidePopup();
    else {
        popup.classList.remove("fade-out");
        showPopup();
    }
});

document.addEventListener("click", (e) => {
    if (!popup.contains(e.target) && popup.style.display === "block") {
        hidePopup();
    }
});

</script>

</body>
</html>
